generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model bank_accounts {
  id             String     @id @default(cuid())
  user_id        String     @unique
  bank_name      String?    @db.VarChar(255)
  branch_name    String?    @db.VarChar(255)
  account_name   String?    @db.VarChar(50)
  account_number String?    @db.VarChar(50)
  account_type   String?    @db.VarChar(50)
  is_deleted     Boolean?   @default(false)
  deleted_at     DateTime?  @db.Timestamp(6)
  created_at     DateTime?  @default(now()) @db.Timestamp(6)
  updated_at     DateTime?  @default(now()) @db.Timestamp(6)
  user           users      @relation(fields: [user_id], references: [id])

  @@index([user_id], map: "idx_bank_accounts_user_id")
  @@index([user_id, is_deleted], map: "idx_bank_accounts_user_id_is_deleted")
  @@index([is_deleted], map: "idx_bank_accounts_is_deleted")
}

model capital {
  id           String    @id @default(cuid())
  capital_type String    @db.VarChar(100)
  amount       Decimal   @db.Decimal(14, 2)
  currency     String?   @default("JMD") @db.VarChar(10)
  description  String?
  is_deleted   Boolean?  @default(false)
  deleted_at   DateTime? @db.Timestamp(6)
  created_at   DateTime? @default(now()) @db.Timestamp(6)
  updated_at   DateTime? @default(now()) @db.Timestamp(6)

  @@index([capital_type], map: "idx_capital_capital_type")
  @@index([currency], map: "idx_capital_currency")
  @@index([is_deleted], map: "idx_capital_is_deleted")
}

model documents {
  id            String     @id @default(cuid())
  user_id       String?
  document_type String?    @db.VarChar(100)
  file_url      String?
  verified      Boolean?   @default(false)
  is_deleted    Boolean?   @default(false)
  deleted_at    DateTime?  @db.Timestamp(6)
  created_at    DateTime?  @default(now()) @db.Timestamp(6)
  updated_at    DateTime?  @default(now()) @db.Timestamp(6)
  users         users?     @relation(fields: [user_id], references: [id])

  @@index([document_type], map: "idx_documents_document_type")
  @@index([user_id], map: "idx_documents_user_id")
  @@index([verified], map: "idx_documents_verified")
  @@index([is_deleted], map: "idx_documents_is_deleted")
}

model employments {
  id              String    @id @default(cuid())
  user_id         String    @unique
  employer_name   String?   @db.VarChar(255)
  job_title       String?   @db.VarChar(100)
  monthly_income  Decimal?  @db.Decimal(12, 2)
  payday_day      Int?
  is_deleted      Boolean?  @default(false)
  deleted_at      DateTime? @db.Timestamp(6)
  created_at      DateTime? @default(now()) @db.Timestamp(6)
  updated_at      DateTime? @default(now()) @db.Timestamp(6)
  user            users     @relation(fields: [user_id], references: [id])

  @@index([is_deleted], map: "idx_employments_is_deleted")
  @@index([user_id], map: "idx_employments_user_id")
}

model interest {
  id          String    @id @default(cuid())
  loan_id     String?
  type        String?   @db.VarChar(50)
  amount      Decimal?  @db.Decimal(12, 2)
  description String?
  is_deleted  Boolean?  @default(false)
  deleted_at  DateTime? @db.Timestamp(6)
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  updated_at  DateTime? @default(now()) @db.Timestamp(6)
  loans       loans?    @relation(fields: [loan_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([loan_id], map: "idx_interest_loan_id")
  @@index([type], map: "idx_interest_type")
  @@index([is_deleted], map: "idx_interest_is_deleted")
}

model applications {
  id               String       @id @default(cuid())
  user_id          String?
  amount_requested Decimal?     @db.Decimal(12, 2)
  term_in_days     Int?
  purpose          String?
  status           String?      @default("submitted")
  decision_reason  String?
  submitted_at     DateTime?    @default(now()) @db.Timestamp(6)
  decided_at       DateTime?    @db.Timestamp(6)
  is_deleted       Boolean?     @default(false)
  deleted_at       DateTime?    @db.Timestamp(6)
  created_at       DateTime?    @default(now()) @db.Timestamp(6)
  updated_at       DateTime?    @default(now()) @db.Timestamp(6)
  users            users?       @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  offers           offers[]

  @@index([status], map: "idx_applications_status")
  @@index([submitted_at], map: "idx_applications_submitted_at")
  @@index([user_id], map: "idx_applications_user_id")
  @@index([is_deleted], map: "idx_applications_is_deleted")
}

model offers {
  id             String        @id @default(cuid())
  application_id String?
  principal      Decimal?      @db.Decimal(12, 2)
  interest_rate  Decimal?      @db.Decimal(5, 2)
  term_in_days   Int?
  status         String?       @default("offered")
  is_deleted     Boolean?      @default(false)
  deleted_at     DateTime?     @db.Timestamp(6)
  created_at     DateTime?     @default(now()) @db.Timestamp(6)
  updated_at     DateTime?     @default(now()) @db.Timestamp(6)
  applications   applications? @relation(fields: [application_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  loans          loans[]

  @@index([application_id], map: "idx_offers_application_id")
  @@index([status], map: "idx_offers_status")
  @@index([is_deleted], map: "idx_offers_is_deleted")
}

model loans {
  id                String       @id @default(cuid())
  user_id           String?
  loan_offer_id     String?
  status            String?      @default("active")
  disbursed_at      DateTime?    @db.Timestamp(6)
  due_date          DateTime?    @db.Date
  total_amount      Decimal?     @db.Decimal(12, 2)
  balance_remaining Decimal?     @db.Decimal(12, 2)
  is_deleted        Boolean?     @default(false)
  deleted_at        DateTime?    @db.Timestamp(6)
  created_at        DateTime?    @default(now()) @db.Timestamp(6)
  updated_at        DateTime?    @default(now()) @db.Timestamp(6)
  interest          interest[]
  offers            offers?      @relation(fields: [loan_offer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users             users?       @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  repayments        repayments[]

  @@index([due_date], map: "idx_loans_due_date")
  @@index([loan_offer_id], map: "idx_loans_loan_offer_id")
  @@index([status], map: "idx_loans_status")
  @@index([user_id], map: "idx_loans_user_id")
  @@index([is_deleted], map: "idx_loans_is_deleted")
}

model notifications {
  id         String    @id @default(cuid())
  user_id    String?
  title      String?   @db.VarChar(255)
  message    String?
  read       Boolean?  @default(false)
  is_deleted Boolean?  @default(false)
  deleted_at DateTime? @db.Timestamp(6)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  updated_at DateTime? @default(now()) @db.Timestamp(6)
  users      users?    @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([created_at], map: "idx_notifications_created_at")
  @@index([read], map: "idx_notifications_read")
  @@index([user_id], map: "idx_notifications_user_id")
  @@index([is_deleted], map: "idx_notifications_is_deleted")
}

model repayments {
  id                    String    @id @default(cuid())
  loan_id               String?
  amount_paid           Decimal?  @db.Decimal(12, 2)
  payment_date          DateTime? @db.Timestamp(6)
  payment_method        String?   @db.VarChar(50)
  transaction_reference String?   @db.VarChar(100)
  is_deleted            Boolean?  @default(false)
  deleted_at            DateTime? @db.Timestamp(6)
  created_at            DateTime? @default(now()) @db.Timestamp(6)
  updated_at            DateTime? @default(now()) @db.Timestamp(6)
  loans                 loans?    @relation(fields: [loan_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([loan_id], map: "idx_repayments_loan_id")
  @@index([payment_date], map: "idx_repayments_payment_date")
  @@index([transaction_reference], map: "idx_repayments_transaction_reference")
  @@index([is_deleted], map: "idx_repayments_is_deleted")
}

model settings {
  id          String    @id @default(cuid())
  key         String    @unique @db.VarChar(100)
  value       String?
  description String?
  is_deleted  Boolean?  @default(false)
  deleted_at  DateTime? @db.Timestamp(6)
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  updated_at  DateTime? @default(now()) @db.Timestamp(6)

  @@index([is_deleted], map: "idx_settings_is_deleted")
}

model users {
  id             String          @id @default(cuid())
  identity       String          @unique @db.VarChar(255)
  first_name     String?         @db.VarChar(100)
  middle_name    String?         @db.VarChar(100)
  last_name      String?         @db.VarChar(100)
  email          String?         @db.VarChar(50)
  dob            DateTime?       @db.Date
  phone_number   String?         @db.VarChar(20)
  trn            String?         @db.VarChar(50)
  street_address String?
  city           String?         @db.VarChar(100)
  country        String?         @db.VarChar(100)
  status         String?         @default("active")
  is_deleted     Boolean?        @default(false)
  deleted_at     DateTime?       @db.Timestamp(6)
  created_at     DateTime?       @default(now()) @db.Timestamp(6)
  updated_at     DateTime?       @default(now()) @db.Timestamp(6)
  employment     employments?
  bank_account   bank_accounts?
  documents      documents[]
  applications   applications[]
  loans          loans[]
  notifications  notifications[]
  roles          roles[]         @relation("user_roles")

  @@index([created_at], map: "idx_users_created_at")
  @@index([identity], map: "idx_users_identity")
  @@index([status], map: "idx_users_status")
  @@index([is_deleted], map: "idx_users_is_deleted")
  @@index([email], map: "idx_users_email")
}

model roles {
  id          String        @id @default(cuid())
  name        String        @unique @db.VarChar(100)
  description String?
  is_deleted  Boolean?      @default(false)
  deleted_at  DateTime?     @db.Timestamp(6)
  created_at  DateTime?     @default(now()) @db.Timestamp(6)
  updated_at  DateTime?     @default(now()) @db.Timestamp(6)

  users       users[]       @relation("user_roles")
  permissions permissions[] @relation("role_permissions")

  @@index([name], map: "idx_roles_name")
  @@index([is_deleted], map: "idx_roles_is_deleted")
}

model permissions {
  id          String   @id @default(cuid())
  name        String   @unique @db.VarChar(100)
  description String?
  is_deleted  Boolean? @default(false)
  deleted_at  DateTime? @db.Timestamp(6)
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  updated_at  DateTime? @default(now()) @db.Timestamp(6)

  roles roles[] @relation("role_permissions")

  @@index([name], map: "idx_permissions_name")
  @@index([is_deleted], map: "idx_permissions_is_deleted")
}